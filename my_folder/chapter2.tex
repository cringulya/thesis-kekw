\chapter{Обзор существующих решений} \label{ch2}

% не рекомендуется использовать отдельную section <<введение>> после лета 2020 года \section{Введение} \label{ch2:intro}


Среди самых распространенных подходов к симуляции жидкости можно выделить три
подхода:
\begin{itemize}
	\item Подход Эйлера\\
	      Область симуляции делится на сетку, в каждом элементе считается векторное
	      поле скоростей
	\item Подход Лагранжа\\
	      Жидкость представляется множеством частиц со своей массой, плотностью,
	      скоростью
	\item Heightfield\\
	      Высота поверхности воды представляется некоторой функцией, что уменьшает
	      размерность задачи
\end{itemize}

В предложенном алгоритме предлагается использовать подход Лагранжа, так как
область симуляции не ограничена сеткой, в отличие от подхода Эйлера. А также
симуляция позволяет моделировать брызги, которые невозможны, если уменьшить
размерность задачи, как в heightfield подходе.


\section{Теоретические основы SPH} \label{ch2:sec-abbr} %название по-русски

Для симуляции частиц был выбран метод Smoothed Particle Hydrodynamics (SPH).

SPH - метод интерполяции для системы частиц, в котором векторное поле,
определеное только в конечном количестве точек, может быть вычислено в любой
точке пространства путем апроксимации.

Скалярная велечина $A$ может быть интерполирована в точке $r$ как взвешенная
сумма вклада всех остальных частиц.

\begin{equation}
	A_s(r) = \sum_i m_j \frac{A_j}{\rho_j} W(r - r_j, h)
\end{equation}

Здесь $j$ итерирует по всем частицам, $m_j$ - масса частицы $j$, $r_j$ -
положение частицы $j$, $\rho_j$ - плотность, $A_j$ - значение поля в точке
$r_j$.
Функция $W(r, h)$ называется сглаживающей ядерной функцией с радиусом $h$.


Массы каждой частицы постоянны и одинаковы на протяжении всей симуляции, в то
время как плотность необходимо апроксимировать на каждом шаге. Получим выражение
для плотности частицы в точке $r$ подстановкой в уравнение (2.1).

\begin{equation}
	\rho_S(r) = \sum_j m_j \frac{\rho_j}{\rho_j} W(r - r_j, h) = \sum_j m_j W(r -
	r_j, h)
\end{equation}

Вычисление производных затрагивает только сглаживающую функцию, поэтому:

\begin{equation}
	\nabla A_S(r) = \sum_j m_j \frac{A_j}{\rho_j} \nabla W(r - r_j, h)
\end{equation}


\begin{equation}
	\nabla^2 A_s(r) = \sum_j m_j \frac{A_j}{\rho_j} \nabla^2 W(r - r_j, h)
\end{equation}

\section{Моделирование жидкости частицами}

Поведение жидкости описывается векторным полем скоростей $v$, полем плотностей
$\rho$ и полем давлений $p$. Изменение этих величин со временем описывается двумя уравнениями. Первое уравнение неразрывности:

\begin{equation}
	\frac{\partial \rho}{\partial t} + \nabla \cdot (\rho v) = 0
\end{equation}

И уравнение Навье-Стокса, описывывающее движение:

\begin{equation}
	\rho(\frac{\partial v}{\partial t} + v \cdot \nabla v) = - \nabla p + \rho g +
	\mu \nabla^2 v,
\end{equation}

где $g$ - внешние силы, $\mu$ - коэффициент вязкости

Использование частиц вместо стационарной сетки упрощает эти два уравнения.
Во-первых, так как число частиц не изменяется и каждая частица имеет постоянную массу, то
сохранение массы гарантировано, и уравнение (2.5) может быть опущено.
Во-вторых, выражение $\frac{\partial v}{\partial t} + v \cdot \nabla v$ в (2.6)
может быть заменено на $\frac{dv}{dt}$. Так как частицы двигаются вместе с
жидкостью, то частная производная векторного поля скоростей просто производная
скоростей частиц по времени, а конвективное слогаемое $v \cdot \nabla v$ не
нужно.

Справа в (2.6) остаются три слагаемых моделирующих плотности сил. Давление
$(-\nabla p)$, внешние силы $\rho g$, взякость $\mu \nabla^2 v$. Таким образом, \\
если $f = - \nabla p + \rho g + \mu \nabla^2 v$, то
ускорение частицы:

\begin{equation}
	a_i = \frac{dv_i}{dt} = \frac{f_i}{\rho_i},
\end{equation}

\subsection{Давление}

Применение SPH апроксимации к слогаемому давления в (2.6) дает

\begin{equation}
	- \nabla p(r_i) = - \sum_j m_j \frac{p_j}{\rho_j} \nabla W(r_i - r_j, h)
\end{equation}

Эта сила не симметрична в отношении двух различных частиц, для исправления этого
предлагается (цитирование):

\begin{equation}
	- \nabla p(r_i) = - \sum_j m_j \frac{p_i + p_j}{2\rho_j} \nabla W(r_i - r_j, h)
\end{equation}

Для вычисления давления используется формула идеального газа

\begin{equation}
	p = k \rho,
\end{equation}
где $k$ - газовая константа, зависящая от температуры.

Но для численной стабильности симуляции используется смещенная величина

\begin{equation}
	p = k (\rho - \rho_0),
\end{equation}
где $\rho_0$ - плотность покоя.


\subsection{Вязкость}

Применяя апроксимацию к слогаемому вязкости в (2.6) получаем

\begin{equation}
	\mu \nabla^2 v(r_i) = \mu \sum_j m_j \frac{v_j}{\rho_j} \nabla^2 W(r_i - r_j,
	h)
\end{equation}

Эти силы также асимметричны, но так как вязкость зависит от разности скоростей,
а не от их абсолютного значения, то симметричной их можно сделать таким образом:

\begin{equation}
	\mu \nabla^2 v(r_i) = \mu \sum_j m_j \frac{v_j - v_i}{\rho_j} \nabla^2 W(r_i - r_j, h).
\end{equation}

\subsection{Поверхностное натяжение}

%% Вспомогательные команды - Additional commands
%
%\newpage % принудительное начало с новой страницы, использовать только в конце раздела
%\clearpage % осуществляется пакетом <<placeins>> в пределах секций
%\newpage\leavevmode\thispagestyle{empty}\newpage % 100 % начало новой страницы
